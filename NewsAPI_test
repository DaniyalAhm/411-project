from flask import Flask, request, redirect

import requests

app = Flask("News Dashboard App")

NEWS_API_KEY = '0a34db30bdc5482fb0e653fef77a3b1d'

# Reddit API Base URL
REDDIT_API_BASE_URL = 'https://www.reddit.com/r/'



# Dictionary to map language values to News API language codes
LANGUAGE_MAP = {
    'english': 'en',
    'spanish': 'es',
    'mandarin': 'zh'
}

@app.route('/login')
def login():
    pass

@app.route('/callback')
def callback():
    pass

@app.route('/logout')
def logout():
    pass

@app.route('/')
def index():
    return redirect('/select_preferences')

@app.route('/select_preferences')
@app.route('/select_preferences', methods=['GET', 'POST'])
def select_preferences():
    if request.method == 'POST':
        # Assuming our form has checkboxes with 'category' as the name
        selected_categories = request.form.getlist('category')

        # Get selected language
        selected_language = request.form.get('language')

        # Comma-separated list of selected categories
        categories = ",".join(selected_categories)

        # Get the language code from the LANGUAGE_MAP
        language_code = LANGUAGE_MAP.get(selected_language, 'en')

        # Make a request to the News API
        news_url = f'https://newsapi.org/v2/top-headlines?category={categories}&language={language_code}&apiKey={NEWS_API_KEY}'
        news_response = requests.get(news_url)

        print("News URL:", news_url)  # Print News API URL (debugging)

        # Make a request to the Reddit API
        reddit_results = []
        for category in selected_categories:
            reddit_url = f'{REDDIT_API_BASE_URL}{category}/.json?limit=5'
            reddit_response = requests.get(reddit_url, headers={'User-agent': 'yourbot'})

            print("Reddit URL:", reddit_url)  # Print Reddit API URL (debugging)

            if reddit_response.status_code == 200:
                reddit_data = reddit_response.json()
                if 'data' in reddit_data and 'children' in reddit_data['data']:
                    for child in reddit_data['data']['children']:
                        reddit_results.append({
                            'title': child['data']['title'],
                            'url': child['data']['url']
                        })

        if news_response.status_code == 200:
            # Parse the JSON response from News API
            news_data = news_response.json()

            print("News Data:", news_data)  # Print the news data for debugging

            # Extract news articles
            news_articles = news_data.get('articles', [])

            if not news_articles:
                news_result = "No news articles found."
            else:
                # Generate a simple string of news articles
                news_strings = []
                for article in news_articles:
                    news_strings.append(f"Title: {article['title']}\nDescription: {article['description']}\n")
                news_result = "\n".join(news_strings)
        else:
            news_result = "Error fetching news. Please try again later."

        if not reddit_results:
            reddit_result = "No Reddit threads found."
        else:
            # Generate a simple string of Reddit threads
            reddit_strings = []
            for thread in reddit_results:
                reddit_strings.append(f"Title: {thread['title']}\nURL: {thread['url']}\n")
            reddit_result = "\n".join(reddit_strings)

        # Combine news and Reddit results
        combined_result = f"----- News Articles -----\n{news_result}\n\n----- Reddit Threads -----\n{reddit_result}"

        return combined_result

    # If it's a GET request, return a form to select categories and language
    return """
    <form method="POST">
        <label><input type="checkbox" name="category" value="business"> Business</label><br>
        <label><input type="checkbox" name="category" value="entertainment"> Entertainment</label><br>
        <label><input type="checkbox" name="category" value="health"> Health</label><br>
        <label><input type="checkbox" name="category" value="science"> Science</label><br>
        <label><input type="checkbox" name="category" value="sports"> Sports</label><br>
        <label><input type="checkbox" name="category" value="technology"> Technology</label><br>
        
        <br>
        
        <label for="language">Select Language:</label>
        <select id="language" name="language">
            <option value="english">English</option>
            <option value="spanish">Spanish</option>
            <option value="mandarin">Mandarin</option>
        </select>
        
        <br><br>
        
        <input type="submit" value="Submit">
    </form>
    """
if __name__ == "__main__":
    app.run(debug=True)

